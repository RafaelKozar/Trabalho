<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">


    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap core CSS -->
    <link href="http://getbootstrap.com/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="http://getbootstrap.com/dist/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="http://getbootstrap.com/assets/js/ie10-viewport-bug-workaround.js"></script>
    <link rel="stylesheet" href="../stylesheets/estilo.css" />
    <script src="../javascripts/meumain3.js"></script>
    <script src="../javascripts/peer.js"></script>
</head>
    <script>
        var tempInicial;
        $(document).ready(function () {
            tempInicial = new Date().getTime();
        });

        window.onbeforeunload = exitSalvar;

        function exitSalvar() {
            var tempFinal = new Date().getTime();
            msToTime(tempFinal);
            var tempDiferenca = tempFinal - tempInicial;
            var url = document.location.href;
            var nota = document.getElementById('nota').value;
            var time = new Date().getTime();
            var data = new Date(time);
            var param = { nota: nota, url: url, tempDiferenca: tempDiferenca, tempInicial: tempInicial, tempFinal: tempFinal, data : data };
            $.post('/cadastrarhistoricodeacesso', param, function (data) {
                message = JSON.parse(data);
            });
        }

        function msToTime(duration) {
            var milliseconds = parseInt((duration % 1000) / 100)
                , seconds = parseInt((duration / 1000) % 60)
                , minutes = parseInt((duration / (1000 * 60)) % 60)
                , hours = parseInt((duration / (1000 * 60 * 60)) % 24);

            hours = (hours < 10) ? "0" + hours : hours;
            minutes = (minutes < 10) ? "0" + minutes : minutes;
            seconds = (seconds < 10) ? "0" + seconds : seconds;

            alert(hours + ":" + minutes + ":" + seconds + "." + milliseconds);
        }

        function salvarAtendimento() {
            var tipoAtendimento = document.getElementById('tipoatendimento').value;
            var atendimento = document.getElementById('atendimento').value;
            var time = new Date().getTime();
            var data = new Date(time);
            var url = document.location.href;
            var param = { tipoAtendimento: tipoAtendimento, atendimento: atendimento, data : data, url : url };
            $.post('/cadastraratendimento', param, function (data) {
                messge = JSON.parse(data);
                alert(messge);
            });
        }

        function atualizaNota() {
            alert("Nota atualizada do acesso");
        }
    </script>
<body>
    <% include header2.ejs %>
    <div class="col-sm-0 col-md-1 col-lg-1 col-xs-0 "></div>
    <div class="col-sm-12 col-md-10 col-lg-10 col-xs-12 conteudo">
       


            <div class="row">
                <div class="col-md-12">
                    <div class="panel-group" id="accordion">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h4 class="panel-title">
                                    <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
                                        <span class="glyphicon glyphicon-file page-header"></span>Paciente
                                    </a>
                                </h4>
                            </div>
                            
                            <div id="collapseOne" class="panel-collapse collapse in">
                                <div class="panel-body">
                                    <div class="row">
                                        <div class="col-md-12">                                            
                                            <div class="col-lg-6 col-md-6">
                                                <video id="local-video" class="video" autoplay></video>
                                            </div>
                                            <div class="col-lg-6 col-md-6">
                                                 <video id="remote-video" class="video" autoplay></video>
                                            </div>
                                         </div>
                                        </div>
                                    <div class="col-lg-12 col-md-12">
                                            <div><button class="button" id="connect">Ligar</button></div>
                                        </div>
                                             <div class="form-group col-lg-3 col-md-3"></div>
                                            <div class="form-group col-lg-6 col-md-6">
                                                                <select class="form-control" name="nota" onchange="atualizaNota()" id="nota">
                                                                    <option value="excelente">Excelente</option>
                                                                    <option value="bom">Bom</option>
                                                                    <option value="medio">Médico</option>
                                                                    <option value="ruim">Ruim</option>
                                                                    <option value="pessimo">Péssimo</option>
                                                                </select>
                                                            </div>
                                             <div class="form-group col-lg-3 col-md-3"></div>

                                    <div class="row">
                                        <div class="col-lg-12 col-md-12">
                                    <h3 class="panel-title">Cadastrar Atendimento</h3>
                                        <div class="form-group col-lg-3 col-md-3"></div>
                                            <div class="form-group col-lg-6 col-md-6">
                                                                <select class="form-control" name="tipoatendimento" id="tipoatendimento">
                                                                    <option value="parecer">Parecer</option>
                                                                    <option value="relatório">Relatório</option>
                                                                    <option value="descrição">Descrição</option>                                                                    
                                                                </select>
                                                            </div>
                                             <div class="form-group col-lg-3 col-md-3"></div>

                                            <div class="form-group col-lg-12 col-md-12">
                                                <textarea class="form-control" id="atendimento" name="atendimento" rows="5" placeholder="Registrar atendimento" ></textarea>
                                            </div>
                                            <div id="messages"></div>

                                            <button class="button form-group" onclick="salvarAtendimento()" type="button">Salvar</button>
                                            
                                        </div>
                                        </div>
                                    </div>
                                    </div>
                                </div>
                            
                        </div>
                    </div>
                </div>
            </div>
        
    </div>
</body>

</html>
